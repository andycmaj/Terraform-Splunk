{
    "version": 3,
    "terraform_version": "0.7.13",
    "serial": 79,
    "lineage": "763536a9-c261-4816-9810-c7654c9f0a53",
    "modules": [
        {
            "path": [
                "root"
            ],
            "outputs": {
                "master_ip": {
                    "sensitive": false,
                    "type": "string",
                    "value": "35.164.242.133"
                }
            },
            "resources": {
                "aws_app_cookie_stickiness_policy.splunk": {
                    "type": "aws_app_cookie_stickiness_policy",
                    "depends_on": [
                        "aws_elb.search"
                    ],
                    "primary": {
                        "id": "splunk-elb:80:splunk-stickiness-policy",
                        "attributes": {
                            "cookie_name": "session_id_8000",
                            "id": "splunk-elb:80:splunk-stickiness-policy",
                            "lb_port": "80",
                            "load_balancer": "splunk-elb",
                            "name": "splunk-stickiness-policy"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "aws_elb.search": {
                    "type": "aws_elb",
                    "depends_on": [
                        "aws_instance.searchhead",
                        "aws_security_group.elb"
                    ],
                    "primary": {
                        "id": "splunk-elb",
                        "attributes": {
                            "access_logs.#": "0",
                            "availability_zones.#": "2",
                            "availability_zones.221770259": "us-west-2b",
                            "availability_zones.2487133097": "us-west-2a",
                            "connection_draining": "true",
                            "connection_draining_timeout": "400",
                            "cross_zone_load_balancing": "true",
                            "dns_name": "splunk-elb-795161331.us-west-2.elb.amazonaws.com",
                            "health_check.#": "1",
                            "health_check.0.healthy_threshold": "2",
                            "health_check.0.interval": "5",
                            "health_check.0.target": "HTTP:8000/en-US/account/login",
                            "health_check.0.timeout": "3",
                            "health_check.0.unhealthy_threshold": "2",
                            "id": "splunk-elb",
                            "idle_timeout": "400",
                            "instances.#": "2",
                            "instances.2604154195": "i-0cb0080ff7c11bcae",
                            "instances.4265659738": "i-02e1c4bfe65c2ac46",
                            "internal": "false",
                            "listener.#": "1",
                            "listener.206423021.instance_port": "8000",
                            "listener.206423021.instance_protocol": "http",
                            "listener.206423021.lb_port": "80",
                            "listener.206423021.lb_protocol": "http",
                            "listener.206423021.ssl_certificate_id": "",
                            "name": "splunk-elb",
                            "security_groups.#": "1",
                            "security_groups.402382610": "sg-0d608775",
                            "source_security_group": "069884434102/sg_splunk_elb",
                            "source_security_group_id": "sg-0d608775",
                            "subnets.#": "2",
                            "subnets.3457752080": "subnet-56976031",
                            "subnets.840808031": "subnet-eaa8a69c",
                            "tags.%": "1",
                            "tags.Name": "splunk_elb",
                            "zone_id": "Z1H1FL5HABSF5"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "aws_instance.consul": {
                    "type": "aws_instance",
                    "depends_on": [
                        "aws_security_group.all",
                        "data.template_file.server_install"
                    ],
                    "primary": {
                        "id": "i-082c66ddf19e391ad",
                        "attributes": {
                            "ami": "ami-b22981d2",
                            "associate_public_ip_address": "true",
                            "availability_zone": "us-west-2a",
                            "disable_api_termination": "false",
                            "ebs_block_device.#": "0",
                            "ebs_optimized": "false",
                            "ephemeral_block_device.#": "0",
                            "iam_instance_profile": "",
                            "id": "i-082c66ddf19e391ad",
                            "instance_state": "running",
                            "instance_type": "t2.micro",
                            "key_name": "dev_key",
                            "monitoring": "false",
                            "network_interface_id": "eni-9c3e2fdc",
                            "private_dns": "ip-10-100-31-123.us-west-2.compute.internal",
                            "private_ip": "10.100.31.123",
                            "public_dns": "",
                            "public_ip": "35.161.248.147",
                            "root_block_device.#": "1",
                            "root_block_device.0.delete_on_termination": "true",
                            "root_block_device.0.iops": "0",
                            "root_block_device.0.volume_size": "8",
                            "root_block_device.0.volume_type": "standard",
                            "security_groups.#": "0",
                            "source_dest_check": "true",
                            "subnet_id": "subnet-eaa8a69c",
                            "tags.%": "2",
                            "tags.ConsulRole": "Server",
                            "tags.Name": "consul-0",
                            "tenancy": "default",
                            "vpc_security_group_ids.#": "1",
                            "vpc_security_group_ids.679839004": "sg-0e608776"
                        },
                        "meta": {
                            "schema_version": "1"
                        },
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "aws_instance.deploymentserver": {
                    "type": "aws_instance",
                    "depends_on": [
                        "aws_security_group.all",
                        "template_file.consul_agent_install",
                        "template_file.user_data_deploymentserver"
                    ],
                    "primary": {
                        "id": "i-08069ef1ba1ddc2ff",
                        "attributes": {
                            "ami": "ami-9504b1f5",
                            "associate_public_ip_address": "true",
                            "availability_zone": "us-west-2a",
                            "disable_api_termination": "false",
                            "ebs_block_device.#": "0",
                            "ebs_optimized": "false",
                            "ephemeral_block_device.#": "0",
                            "iam_instance_profile": "",
                            "id": "i-08069ef1ba1ddc2ff",
                            "instance_state": "running",
                            "instance_type": "t2.micro",
                            "key_name": "dev_key",
                            "monitoring": "false",
                            "network_interface_id": "eni-ed2534ad",
                            "private_dns": "ip-10-100-50-50.us-west-2.compute.internal",
                            "private_ip": "10.100.50.50",
                            "public_dns": "",
                            "public_ip": "35.166.91.30",
                            "root_block_device.#": "1",
                            "root_block_device.0.delete_on_termination": "true",
                            "root_block_device.0.iops": "0",
                            "root_block_device.0.volume_size": "1000",
                            "root_block_device.0.volume_type": "standard",
                            "security_groups.#": "0",
                            "source_dest_check": "true",
                            "subnet_id": "subnet-eaa8a69c",
                            "tags.%": "1",
                            "tags.Name": "splunk_deploymentserver",
                            "tenancy": "default",
                            "user_data": "e034acbb9bb8a6a2295f2a003a1788b358bef887",
                            "vpc_security_group_ids.#": "1",
                            "vpc_security_group_ids.679839004": "sg-0e608776"
                        },
                        "meta": {
                            "schema_version": "1"
                        },
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "aws_instance.indexer.0": {
                    "type": "aws_instance",
                    "depends_on": [
                        "aws_security_group.all",
                        "template_file.consul_agent_install",
                        "template_file.user_data_indexer"
                    ],
                    "primary": {
                        "id": "i-03e6b1de68690704b",
                        "attributes": {
                            "ami": "ami-9504b1f5",
                            "associate_public_ip_address": "true",
                            "availability_zone": "us-west-2a",
                            "disable_api_termination": "false",
                            "ebs_block_device.#": "0",
                            "ebs_optimized": "false",
                            "ephemeral_block_device.#": "0",
                            "iam_instance_profile": "",
                            "id": "i-03e6b1de68690704b",
                            "instance_state": "running",
                            "instance_type": "t2.micro",
                            "key_name": "dev_key",
                            "monitoring": "false",
                            "network_interface_id": "eni-36223376",
                            "private_dns": "ip-10-100-47-206.us-west-2.compute.internal",
                            "private_ip": "10.100.47.206",
                            "public_dns": "",
                            "public_ip": "35.165.217.57",
                            "root_block_device.#": "1",
                            "root_block_device.0.delete_on_termination": "true",
                            "root_block_device.0.iops": "0",
                            "root_block_device.0.volume_size": "1000",
                            "root_block_device.0.volume_type": "standard",
                            "security_groups.#": "0",
                            "source_dest_check": "true",
                            "subnet_id": "subnet-eaa8a69c",
                            "tags.%": "1",
                            "tags.Name": "splunk_indexer",
                            "tenancy": "default",
                            "user_data": "286a14d00a1a82759a94b5a5366d79dca952ad39",
                            "vpc_security_group_ids.#": "1",
                            "vpc_security_group_ids.679839004": "sg-0e608776"
                        },
                        "meta": {
                            "schema_version": "1"
                        },
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "aws_instance.indexer.1": {
                    "type": "aws_instance",
                    "depends_on": [
                        "aws_security_group.all",
                        "template_file.consul_agent_install",
                        "template_file.user_data_indexer"
                    ],
                    "primary": {
                        "id": "i-0fcd67f5e105daeaf",
                        "attributes": {
                            "ami": "ami-9504b1f5",
                            "associate_public_ip_address": "true",
                            "availability_zone": "us-west-2b",
                            "disable_api_termination": "false",
                            "ebs_block_device.#": "0",
                            "ebs_optimized": "false",
                            "ephemeral_block_device.#": "0",
                            "iam_instance_profile": "",
                            "id": "i-0fcd67f5e105daeaf",
                            "instance_state": "running",
                            "instance_type": "t2.micro",
                            "key_name": "dev_key",
                            "monitoring": "false",
                            "network_interface_id": "eni-55274224",
                            "private_dns": "ip-10-100-162-188.us-west-2.compute.internal",
                            "private_ip": "10.100.162.188",
                            "public_dns": "",
                            "public_ip": "35.166.110.237",
                            "root_block_device.#": "1",
                            "root_block_device.0.delete_on_termination": "true",
                            "root_block_device.0.iops": "0",
                            "root_block_device.0.volume_size": "1000",
                            "root_block_device.0.volume_type": "standard",
                            "security_groups.#": "0",
                            "source_dest_check": "true",
                            "subnet_id": "subnet-56976031",
                            "tags.%": "1",
                            "tags.Name": "splunk_indexer",
                            "tenancy": "default",
                            "user_data": "286a14d00a1a82759a94b5a5366d79dca952ad39",
                            "vpc_security_group_ids.#": "1",
                            "vpc_security_group_ids.679839004": "sg-0e608776"
                        },
                        "meta": {
                            "schema_version": "1"
                        },
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "aws_instance.master": {
                    "type": "aws_instance",
                    "depends_on": [
                        "aws_security_group.all",
                        "template_file.consul_agent_install",
                        "template_file.user_data_master"
                    ],
                    "primary": {
                        "id": "i-0a0c5c46091068afa",
                        "attributes": {
                            "ami": "ami-9504b1f5",
                            "associate_public_ip_address": "true",
                            "availability_zone": "us-west-2a",
                            "disable_api_termination": "false",
                            "ebs_block_device.#": "0",
                            "ebs_optimized": "false",
                            "ephemeral_block_device.#": "0",
                            "iam_instance_profile": "",
                            "id": "i-0a0c5c46091068afa",
                            "instance_state": "running",
                            "instance_type": "t2.micro",
                            "key_name": "dev_key",
                            "monitoring": "false",
                            "network_interface_id": "eni-c13b2a81",
                            "private_dns": "ip-10-100-51-159.us-west-2.compute.internal",
                            "private_ip": "10.100.51.159",
                            "public_dns": "",
                            "public_ip": "35.164.242.133",
                            "root_block_device.#": "1",
                            "root_block_device.0.delete_on_termination": "true",
                            "root_block_device.0.iops": "0",
                            "root_block_device.0.volume_size": "1000",
                            "root_block_device.0.volume_type": "standard",
                            "security_groups.#": "0",
                            "source_dest_check": "true",
                            "subnet_id": "subnet-eaa8a69c",
                            "tags.%": "1",
                            "tags.Name": "splunk_master",
                            "tenancy": "default",
                            "user_data": "005bb5abe3cafb3d1577deeed9a3060c5a535fca",
                            "vpc_security_group_ids.#": "1",
                            "vpc_security_group_ids.679839004": "sg-0e608776"
                        },
                        "meta": {
                            "schema_version": "1"
                        },
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "aws_instance.searchhead.0": {
                    "type": "aws_instance",
                    "depends_on": [
                        "aws_security_group.all",
                        "template_file.consul_agent_install",
                        "template_file.user_data_searchhead"
                    ],
                    "primary": {
                        "id": "i-0cb0080ff7c11bcae",
                        "attributes": {
                            "ami": "ami-9504b1f5",
                            "associate_public_ip_address": "true",
                            "availability_zone": "us-west-2a",
                            "disable_api_termination": "false",
                            "ebs_block_device.#": "0",
                            "ebs_optimized": "false",
                            "ephemeral_block_device.#": "0",
                            "iam_instance_profile": "",
                            "id": "i-0cb0080ff7c11bcae",
                            "instance_state": "running",
                            "instance_type": "t2.micro",
                            "key_name": "dev_key",
                            "monitoring": "false",
                            "network_interface_id": "eni-4f3f2e0f",
                            "private_dns": "ip-10-100-6-202.us-west-2.compute.internal",
                            "private_ip": "10.100.6.202",
                            "public_dns": "",
                            "public_ip": "35.166.13.210",
                            "root_block_device.#": "1",
                            "root_block_device.0.delete_on_termination": "true",
                            "root_block_device.0.iops": "0",
                            "root_block_device.0.volume_size": "500",
                            "root_block_device.0.volume_type": "standard",
                            "security_groups.#": "0",
                            "source_dest_check": "true",
                            "subnet_id": "subnet-eaa8a69c",
                            "tags.%": "1",
                            "tags.Name": "splunk_searchhead",
                            "tenancy": "default",
                            "user_data": "9e8c65aca0b1d9e32a6625b78c642e93c24f5f7e",
                            "vpc_security_group_ids.#": "1",
                            "vpc_security_group_ids.679839004": "sg-0e608776"
                        },
                        "meta": {
                            "schema_version": "1"
                        },
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "aws_instance.searchhead.1": {
                    "type": "aws_instance",
                    "depends_on": [
                        "aws_security_group.all",
                        "template_file.consul_agent_install",
                        "template_file.user_data_searchhead"
                    ],
                    "primary": {
                        "id": "i-02e1c4bfe65c2ac46",
                        "attributes": {
                            "ami": "ami-9504b1f5",
                            "associate_public_ip_address": "true",
                            "availability_zone": "us-west-2b",
                            "disable_api_termination": "false",
                            "ebs_block_device.#": "0",
                            "ebs_optimized": "false",
                            "ephemeral_block_device.#": "0",
                            "iam_instance_profile": "",
                            "id": "i-02e1c4bfe65c2ac46",
                            "instance_state": "running",
                            "instance_type": "t2.micro",
                            "key_name": "dev_key",
                            "monitoring": "false",
                            "network_interface_id": "eni-74224705",
                            "private_dns": "ip-10-100-147-36.us-west-2.compute.internal",
                            "private_ip": "10.100.147.36",
                            "public_dns": "",
                            "public_ip": "35.165.87.167",
                            "root_block_device.#": "1",
                            "root_block_device.0.delete_on_termination": "true",
                            "root_block_device.0.iops": "0",
                            "root_block_device.0.volume_size": "500",
                            "root_block_device.0.volume_type": "standard",
                            "security_groups.#": "0",
                            "source_dest_check": "true",
                            "subnet_id": "subnet-56976031",
                            "tags.%": "1",
                            "tags.Name": "splunk_searchhead",
                            "tenancy": "default",
                            "user_data": "9e8c65aca0b1d9e32a6625b78c642e93c24f5f7e",
                            "vpc_security_group_ids.#": "1",
                            "vpc_security_group_ids.679839004": "sg-0e608776"
                        },
                        "meta": {
                            "schema_version": "1"
                        },
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "aws_lb_cookie_stickiness_policy.search": {
                    "type": "aws_lb_cookie_stickiness_policy",
                    "depends_on": [
                        "aws_elb.search"
                    ],
                    "primary": {
                        "id": "splunk-elb:80:splunk-lb-policy",
                        "attributes": {
                            "cookie_expiration_period": "1800",
                            "id": "splunk-elb:80:splunk-lb-policy",
                            "lb_port": "80",
                            "load_balancer": "splunk-elb",
                            "name": "splunk-lb-policy"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "aws_security_group.all": {
                    "type": "aws_security_group",
                    "depends_on": [],
                    "primary": {
                        "id": "sg-0e608776",
                        "attributes": {
                            "description": "Common rules for all",
                            "egress.#": "1",
                            "egress.482069346.cidr_blocks.#": "1",
                            "egress.482069346.cidr_blocks.0": "0.0.0.0/0",
                            "egress.482069346.from_port": "0",
                            "egress.482069346.prefix_list_ids.#": "0",
                            "egress.482069346.protocol": "-1",
                            "egress.482069346.security_groups.#": "0",
                            "egress.482069346.self": "false",
                            "egress.482069346.to_port": "0",
                            "id": "sg-0e608776",
                            "ingress.#": "5",
                            "ingress.2541437006.cidr_blocks.#": "1",
                            "ingress.2541437006.cidr_blocks.0": "0.0.0.0/0",
                            "ingress.2541437006.from_port": "22",
                            "ingress.2541437006.protocol": "tcp",
                            "ingress.2541437006.security_groups.#": "0",
                            "ingress.2541437006.self": "false",
                            "ingress.2541437006.to_port": "22",
                            "ingress.332570261.cidr_blocks.#": "1",
                            "ingress.332570261.cidr_blocks.0": "0.0.0.0/0",
                            "ingress.332570261.from_port": "8000",
                            "ingress.332570261.protocol": "tcp",
                            "ingress.332570261.security_groups.#": "0",
                            "ingress.332570261.self": "false",
                            "ingress.332570261.to_port": "8000",
                            "ingress.3472572478.cidr_blocks.#": "0",
                            "ingress.3472572478.from_port": "0",
                            "ingress.3472572478.protocol": "udp",
                            "ingress.3472572478.security_groups.#": "0",
                            "ingress.3472572478.self": "true",
                            "ingress.3472572478.to_port": "65535",
                            "ingress.3482902040.cidr_blocks.#": "1",
                            "ingress.3482902040.cidr_blocks.0": "0.0.0.0/0",
                            "ingress.3482902040.from_port": "8500",
                            "ingress.3482902040.protocol": "tcp",
                            "ingress.3482902040.security_groups.#": "0",
                            "ingress.3482902040.self": "false",
                            "ingress.3482902040.to_port": "8500",
                            "ingress.3544538468.cidr_blocks.#": "0",
                            "ingress.3544538468.from_port": "0",
                            "ingress.3544538468.protocol": "tcp",
                            "ingress.3544538468.security_groups.#": "0",
                            "ingress.3544538468.self": "true",
                            "ingress.3544538468.to_port": "65535",
                            "name": "sg_splunk_all",
                            "owner_id": "069884434102",
                            "tags.%": "0",
                            "vpc_id": "vpc-a806d3cf"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "aws_security_group.elb": {
                    "type": "aws_security_group",
                    "depends_on": [],
                    "primary": {
                        "id": "sg-0d608775",
                        "attributes": {
                            "description": "Used in the terraform",
                            "egress.#": "1",
                            "egress.482069346.cidr_blocks.#": "1",
                            "egress.482069346.cidr_blocks.0": "0.0.0.0/0",
                            "egress.482069346.from_port": "0",
                            "egress.482069346.prefix_list_ids.#": "0",
                            "egress.482069346.protocol": "-1",
                            "egress.482069346.security_groups.#": "0",
                            "egress.482069346.self": "false",
                            "egress.482069346.to_port": "0",
                            "id": "sg-0d608775",
                            "ingress.#": "2",
                            "ingress.2214680975.cidr_blocks.#": "1",
                            "ingress.2214680975.cidr_blocks.0": "0.0.0.0/0",
                            "ingress.2214680975.from_port": "80",
                            "ingress.2214680975.protocol": "tcp",
                            "ingress.2214680975.security_groups.#": "0",
                            "ingress.2214680975.self": "false",
                            "ingress.2214680975.to_port": "80",
                            "ingress.2617001939.cidr_blocks.#": "1",
                            "ingress.2617001939.cidr_blocks.0": "0.0.0.0/0",
                            "ingress.2617001939.from_port": "443",
                            "ingress.2617001939.protocol": "tcp",
                            "ingress.2617001939.security_groups.#": "0",
                            "ingress.2617001939.self": "false",
                            "ingress.2617001939.to_port": "443",
                            "name": "sg_splunk_elb",
                            "owner_id": "069884434102",
                            "tags.%": "0",
                            "vpc_id": "vpc-a806d3cf"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "aws_security_group.searchhead": {
                    "type": "aws_security_group",
                    "depends_on": [
                        "aws_security_group.elb"
                    ],
                    "primary": {
                        "id": "sg-0260877a",
                        "attributes": {
                            "description": "Used in the  terraform",
                            "egress.#": "0",
                            "id": "sg-0260877a",
                            "ingress.#": "1",
                            "ingress.988279867.cidr_blocks.#": "0",
                            "ingress.988279867.from_port": "8000",
                            "ingress.988279867.protocol": "tcp",
                            "ingress.988279867.security_groups.#": "1",
                            "ingress.988279867.security_groups.402382610": "sg-0d608775",
                            "ingress.988279867.self": "false",
                            "ingress.988279867.to_port": "8000",
                            "name": "sg_splunk_searchhead",
                            "owner_id": "069884434102",
                            "tags.%": "0",
                            "vpc_id": "vpc-a806d3cf"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "aws_security_group_rule.interco": {
                    "type": "aws_security_group_rule",
                    "depends_on": [
                        "aws_security_group.all"
                    ],
                    "primary": {
                        "id": "sgrule-3365785042",
                        "attributes": {
                            "from_port": "0",
                            "id": "sgrule-3365785042",
                            "protocol": "-1",
                            "security_group_id": "sg-0e608776",
                            "self": "false",
                            "source_security_group_id": "sg-0e608776",
                            "to_port": "0",
                            "type": "ingress"
                        },
                        "meta": {
                            "schema_version": "2"
                        },
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "data.template_file.server_install": {
                    "type": "template_file",
                    "depends_on": [],
                    "primary": {
                        "id": "d7d404279280e5e3daade2a235877a0c2235355158dc24098a0562a5908adf17",
                        "attributes": {
                            "id": "d7d404279280e5e3daade2a235877a0c2235355158dc24098a0562a5908adf17",
                            "rendered": "#!/usr/bin/env bash\nset -e\n\nSERVICE_NAME=$1\n\necho \"Installing dependencies...\"\nif [ -x \"$(command -v apt-get)\" ]; then\n  sudo apt-get update -y\n  sudo apt-get install -y unzip\nelse\n  sudo yum update -y\n  sudo yum install -y unzip wget\nfi\n\necho \"Fetching Consul...\"\nCONSUL=0.7.1\ncd /tmp\nwget https://releases.hashicorp.com/consul/${CONSUL}/consul_${CONSUL}_linux_amd64.zip -O consul.zip\n\necho \"Installing Consul...\"\nunzip consul.zip \u003e/dev/null\nchmod +x consul\nsudo mv consul /usr/local/bin/consul\nsudo mkdir -p /opt/consul/data\n\n# Read from the file we created\nSERVER_COUNT=$(cat /tmp/consul-server-count | tr -d '\\n')\nCONSUL_JOIN=$(cat /tmp/consul-server-addr | tr -d '\\n')\n\nINSTANCE_IP=\"$(curl http://169.254.169.254/latest/meta-data/local-ipv4)\"\n\n# Write the flags to a temporary file\ncat \u003e/tmp/consul_flags \u003c\u003c EOF\nCONSUL_FLAGS=\"-server -bootstrap-expect=${SERVER_COUNT} -join=${CONSUL_JOIN} -data-dir=/opt/consul/data -ui -client 0.0.0.0\"\nEOF\n\nif [ -f /tmp/upstart.conf ];\nthen\n  echo \"Installing Upstart service...\"\n  sudo mkdir -p /etc/consul.d\n\n  if [ ! -z \"$SERVICE_NAME\" ]; then\n    sudo mkdir -p /etc/dnsmasq.d\n    sudo echo \"server=/consul/127.0.0.1#8600\" | sudo tee /etc/dnsmasq.d/10-consul\n    sudo apt-get install -y dnsmasq\n    sudo echo '{\"service\": {\"name\": \"'\"$SERVICE_NAME\"'\", \"port\": 8089}}' | sudo tee /etc/consul.d/cluster-master.json\n  fi\n\n  sudo mkdir -p /etc/service\n  sudo chown root:root /tmp/upstart.conf\n  sudo mv /tmp/upstart.conf /etc/init/consul.conf\n  sudo chmod 0644 /etc/init/consul.conf\n  sudo mv /tmp/consul_flags /etc/service/consul\n  sudo chmod 0644 /etc/service/consul\nelse\n  echo \"Installing Systemd service...\"\n  sudo mkdir -p /etc/systemd/system/consul.d\n  sudo chown root:root /tmp/consul.service\n  sudo mv /tmp/consul.service /etc/systemd/system/consul.service\n  sudo chmod 0644 /etc/systemd/system/consul.service\n  sudo mv /tmp/consul_flags /etc/sysconfig/consul\n  sudo chown root:root /etc/sysconfig/consul\n  sudo chmod 0644 /etc/sysconfig/consul\nfi\n",
                            "template": "/Workspaces/Terraform-Splunk/consul/scripts/install.tpl",
                            "vars.%": "1",
                            "vars.consul_params": "-server -bootstrap-expect=${SERVER_COUNT} -join=${CONSUL_JOIN} -data-dir=/opt/consul/data -ui -client 0.0.0.0"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "template_file.consul_agent_install": {
                    "type": "template_file",
                    "depends_on": [
                        "aws_instance.consul"
                    ],
                    "primary": {
                        "id": "0adeebea918c7e8389ae3b2c369fa9a31bfad81fbf4b643fa93c64f79b223e05",
                        "attributes": {
                            "id": "0adeebea918c7e8389ae3b2c369fa9a31bfad81fbf4b643fa93c64f79b223e05",
                            "rendered": "#!/usr/bin/env bash\nset -e\n\nSERVICE_NAME=$1\n\necho \"Installing dependencies...\"\nif [ -x \"$(command -v apt-get)\" ]; then\n  sudo apt-get update -y\n  sudo apt-get install -y unzip\nelse\n  sudo yum update -y\n  sudo yum install -y unzip wget\nfi\n\necho \"Fetching Consul...\"\nCONSUL=0.7.1\ncd /tmp\nwget https://releases.hashicorp.com/consul/${CONSUL}/consul_${CONSUL}_linux_amd64.zip -O consul.zip\n\necho \"Installing Consul...\"\nunzip consul.zip \u003e/dev/null\nchmod +x consul\nsudo mv consul /usr/local/bin/consul\nsudo mkdir -p /opt/consul/data\n\n# Read from the file we created\nSERVER_COUNT=$(cat /tmp/consul-server-count | tr -d '\\n')\nCONSUL_JOIN=$(cat /tmp/consul-server-addr | tr -d '\\n')\n\nINSTANCE_IP=\"$(curl http://169.254.169.254/latest/meta-data/local-ipv4)\"\n\n# Write the flags to a temporary file\ncat \u003e/tmp/consul_flags \u003c\u003c EOF\nCONSUL_FLAGS=\"-advertise ${INSTANCE_IP} -retry-join=10.100.31.123 -data-dir=/opt/consul/data -client 0.0.0.0\"\nEOF\n\nif [ -f /tmp/upstart.conf ];\nthen\n  echo \"Installing Upstart service...\"\n  sudo mkdir -p /etc/consul.d\n\n  if [ ! -z \"$SERVICE_NAME\" ]; then\n    sudo mkdir -p /etc/dnsmasq.d\n    sudo echo \"server=/consul/127.0.0.1#8600\" | sudo tee /etc/dnsmasq.d/10-consul\n    sudo apt-get install -y dnsmasq\n    sudo echo '{\"service\": {\"name\": \"'\"$SERVICE_NAME\"'\", \"port\": 8089}}' | sudo tee /etc/consul.d/cluster-master.json\n  fi\n\n  sudo mkdir -p /etc/service\n  sudo chown root:root /tmp/upstart.conf\n  sudo mv /tmp/upstart.conf /etc/init/consul.conf\n  sudo chmod 0644 /etc/init/consul.conf\n  sudo mv /tmp/consul_flags /etc/service/consul\n  sudo chmod 0644 /etc/service/consul\nelse\n  echo \"Installing Systemd service...\"\n  sudo mkdir -p /etc/systemd/system/consul.d\n  sudo chown root:root /tmp/consul.service\n  sudo mv /tmp/consul.service /etc/systemd/system/consul.service\n  sudo chmod 0644 /etc/systemd/system/consul.service\n  sudo mv /tmp/consul_flags /etc/sysconfig/consul\n  sudo chown root:root /etc/sysconfig/consul\n  sudo chmod 0644 /etc/sysconfig/consul\nfi\n",
                            "template": "/Workspaces/Terraform-Splunk/consul/scripts/install.tpl",
                            "vars.%": "1",
                            "vars.consul_params": "-advertise ${INSTANCE_IP} -retry-join=10.100.31.123 -data-dir=/opt/consul/data -client 0.0.0.0"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "template_file.deploymentclient_conf": {
                    "type": "template_file",
                    "depends_on": [],
                    "primary": {
                        "id": "05b59d35f8c2553f8dd67456b960924ebe9692d4c367779e376fde4405623061",
                        "attributes": {
                            "id": "05b59d35f8c2553f8dd67456b960924ebe9692d4c367779e376fde4405623061",
                            "rendered": "[target-broker:deploymentServer]\ntargetUri = deployment-server.service.consul:8089\n",
                            "template": "[target-broker:deploymentServer]\ntargetUri = deployment-server.service.consul:${mgmtHostPort}\n",
                            "vars.%": "2",
                            "vars.deploymentserver_ip": "10.100.50.50",
                            "vars.mgmtHostPort": "8089"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "template_file.server_conf_indexer": {
                    "type": "template_file",
                    "depends_on": [
                        "aws_instance.master"
                    ],
                    "primary": {
                        "id": "1c71475dfa6cd03398cad9bcbe352823e9952289e589fceeb91c4df36e718d9f",
                        "attributes": {
                            "id": "1c71475dfa6cd03398cad9bcbe352823e9952289e589fceeb91c4df36e718d9f",
                            "rendered": "[replication_port://9887]\n\n[clustering]\nmode = slave\nmaster_uri = https://cluster-master.service.consul:8089\npass4SymmKey = BitchBetterHaveMyMoney\n",
                            "template": "[replication_port://${replication_port}]\n\n[clustering]\nmode = slave\nmaster_uri = https://cluster-master.service.consul:${mgmtHostPort}\npass4SymmKey = ${pass4SymmKey}\n",
                            "vars.%": "4",
                            "vars.master_ip": "10.100.51.159",
                            "vars.mgmtHostPort": "8089",
                            "vars.pass4SymmKey": "BitchBetterHaveMyMoney",
                            "vars.replication_port": "9887"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "template_file.server_conf_master": {
                    "type": "template_file",
                    "depends_on": [],
                    "primary": {
                        "id": "8a5bd21b16d591542e300b9f683eb40693c37afae758389006fdd6b54032d928",
                        "attributes": {
                            "id": "8a5bd21b16d591542e300b9f683eb40693c37afae758389006fdd6b54032d928",
                            "rendered": "[clustering]\nmode = master\nreplication_factor = 2\nsearch_factor = 2\npass4SymmKey = BitchBetterHaveMyMoney\n\n[shclustering]\nid = 776D2949-B2DA-405E-96B3-B6688C87AB7D\npass4SymmKey = BitchBetterHaveMyMoney\nshcluster_label = shcluster\n",
                            "template": "[clustering]\nmode = master\nreplication_factor = ${replication_factor}\nsearch_factor = ${search_factor}\npass4SymmKey = ${pass4SymmKey}\n\n[shclustering]\nid = 776D2949-B2DA-405E-96B3-B6688C87AB7D\npass4SymmKey = ${pass4SymmKey}\nshcluster_label = shcluster\n",
                            "vars.%": "3",
                            "vars.pass4SymmKey": "BitchBetterHaveMyMoney",
                            "vars.replication_factor": "2",
                            "vars.search_factor": "2"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "template_file.server_conf_searchhead": {
                    "type": "template_file",
                    "depends_on": [
                        "aws_instance.master"
                    ],
                    "primary": {
                        "id": "6a5803555dea714cdfc9ad56d40e271046eb71f5f8fe8ca0f78707a4c35ed60a",
                        "attributes": {
                            "id": "6a5803555dea714cdfc9ad56d40e271046eb71f5f8fe8ca0f78707a4c35ed60a",
                            "rendered": "[general]\nallowRemoteLogin = always\n\n[clustering]\nmode = searchhead\nmaster_uri = https://cluster-master.service.consul:8089\npass4SymmKey = BitchBetterHaveMyMoney\n\n[replication_port://9887]\n\n[shclustering]\nid = 776D2949-B2DA-405E-96B3-B6688C87AB7D\nconf_deploy_fetch_url = https://deployment-server.service.consul:8089\ndisabled = false\nelection_timeout_ms = 10000\nmgmt_uri = https://LOCAL_IP:8089\npass4SymmKey = BitchBetterHaveMyMoney\nreplication_factor = 2\nshcluster_label = shcluster\n",
                            "template": "[general]\nallowRemoteLogin = always\n\n[clustering]\nmode = searchhead\nmaster_uri = https://cluster-master.service.consul:${mgmtHostPort}\npass4SymmKey = ${pass4SymmKey}\n\n[replication_port://${replication_port}]\n\n[shclustering]\nid = 776D2949-B2DA-405E-96B3-B6688C87AB7D\nconf_deploy_fetch_url = https://deployment-server.service.consul:${mgmtHostPort}\ndisabled = false\nelection_timeout_ms = 10000\nmgmt_uri = https://LOCAL_IP:8089\npass4SymmKey = ${pass4SymmKey}\nreplication_factor = 2\nshcluster_label = shcluster\n",
                            "vars.%": "4",
                            "vars.master_ip": "10.100.51.159",
                            "vars.mgmtHostPort": "8089",
                            "vars.pass4SymmKey": "BitchBetterHaveMyMoney",
                            "vars.replication_port": "9887"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "template_file.serverclass_conf": {
                    "type": "template_file",
                    "depends_on": [
                        "aws_instance.master"
                    ],
                    "primary": {
                        "id": "741054ef63b31c4047cf40ca34618da77185f1eb7eabb882d0da17d2b4a911b8",
                        "attributes": {
                            "id": "741054ef63b31c4047cf40ca34618da77185f1eb7eabb882d0da17d2b4a911b8",
                            "rendered": "[global]\nwhitelist.0 = *\n\n[serverClass:sc_master]\nstateOnClient = \"noop\"\nwhitelist.0 = cluster-master.service.consul\n\n[serverClass:sc_searchhead]\nwhitelist.0 = *\nblacklist.0 = cluster-master.service.consul\n",
                            "template": "[global]\nwhitelist.0 = *\n\n[serverClass:sc_master]\nstateOnClient = \"noop\"\nwhitelist.0 = cluster-master.service.consul\n\n[serverClass:sc_searchhead]\nwhitelist.0 = *\nblacklist.0 = cluster-master.service.consul\n",
                            "vars.%": "1",
                            "vars.master_ip": "10.100.51.159"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "template_file.user_data_deploymentserver": {
                    "type": "template_file",
                    "depends_on": [
                        "template_file.serverclass_conf",
                        "template_file.web_conf"
                    ],
                    "primary": {
                        "id": "97c612d5c2314c663a5c4b0880b7a9e2eeda50ebab79d841b7063c130ac21bb8",
                        "attributes": {
                            "id": "97c612d5c2314c663a5c4b0880b7a9e2eeda50ebab79d841b7063c130ac21bb8",
                            "rendered": "#!/bin/bash\n\nset -x\nexec 1\u003e /var/tmp/mylog 2\u003e\u00261\n\n# Update hostname\nhostname splunk-deploymentserver-`hostname`\necho `hostname` \u003e /etc/hostname\nsed -i 's/localhost$/localhost '`hostname`'/' /etc/hosts\n\nINSTANCE_IP=\"$(curl http://169.254.169.254/latest/meta-data/local-ipv4)\"\n\n# Create local config files\nmkdir -p /opt/splunk/etc/system/local\n\ncat \u003c\u003cEOF | sudo -u splunk tee /opt/splunk/etc/system/local/deploymentclient.conf\n\nEOF\n\ncat \u003c\u003cEOF | sudo -u splunk tee /opt/splunk/etc/system/local/web.conf\n[settings]\nhttpport        = 8000\nmgmtHostPort    = 127.0.0.1:8089\n\nEOF\n\ncat \u003c\u003cEOF | sudo -u splunk tee /opt/splunk/etc/system/local/server.conf\n\nEOF\nsed -i 's/LOCAL_IP/'${INSTANCE_IP}'/' /opt/splunk/etc/system/local/server.conf\n\ncat \u003c\u003cEOF | sudo -u splunk tee /opt/splunk/etc/system/local/serverclass.conf\n[global]\nwhitelist.0 = *\n\n[serverClass:sc_master]\nstateOnClient = \"noop\"\nwhitelist.0 = cluster-master.service.consul\n\n[serverClass:sc_searchhead]\nwhitelist.0 = *\nblacklist.0 = cluster-master.service.consul\n\nEOF\n\n# Start service and Enable autostart\n# sudo -u splunk /opt/splunk/bin/splunk enable boot-start -user splunk --accept-license\n\n\n\n/opt/splunk/bin/entrypoint.sh start-service\n",
                            "template": "#!/bin/bash\n\nset -x\nexec 1\u003e /var/tmp/mylog 2\u003e\u00261\n\n# Update hostname\nhostname splunk-${role}-`hostname`\necho `hostname` \u003e /etc/hostname\nsed -i 's/localhost$/localhost '`hostname`'/' /etc/hosts\n\nINSTANCE_IP=\"$(curl http://169.254.169.254/latest/meta-data/local-ipv4)\"\n\n# Create local config files\nmkdir -p /opt/splunk/etc/system/local\n\ncat \u003c\u003cEOF | sudo -u splunk tee /opt/splunk/etc/system/local/deploymentclient.conf\n${deploymentclient_conf_content}\nEOF\n\ncat \u003c\u003cEOF | sudo -u splunk tee /opt/splunk/etc/system/local/web.conf\n${web_conf_content}\nEOF\n\ncat \u003c\u003cEOF | sudo -u splunk tee /opt/splunk/etc/system/local/server.conf\n${server_conf_content}\nEOF\nsed -i 's/LOCAL_IP/'$${INSTANCE_IP}'/' /opt/splunk/etc/system/local/server.conf\n\ncat \u003c\u003cEOF | sudo -u splunk tee /opt/splunk/etc/system/local/serverclass.conf\n${serverclass_conf_content}\nEOF\n\n# Start service and Enable autostart\n# sudo -u splunk /opt/splunk/bin/splunk enable boot-start -user splunk --accept-license\n\n${cmds_content}\n\n/opt/splunk/bin/entrypoint.sh start-service\n",
                            "vars.%": "6",
                            "vars.cmds_content": "",
                            "vars.deploymentclient_conf_content": "",
                            "vars.role": "deploymentserver",
                            "vars.server_conf_content": "",
                            "vars.serverclass_conf_content": "[global]\nwhitelist.0 = *\n\n[serverClass:sc_master]\nstateOnClient = \"noop\"\nwhitelist.0 = cluster-master.service.consul\n\n[serverClass:sc_searchhead]\nwhitelist.0 = *\nblacklist.0 = cluster-master.service.consul\n",
                            "vars.web_conf_content": "[settings]\nhttpport        = 8000\nmgmtHostPort    = 127.0.0.1:8089\n"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "template_file.user_data_indexer": {
                    "type": "template_file",
                    "depends_on": [
                        "template_file.server_conf_indexer",
                        "template_file.web_conf"
                    ],
                    "primary": {
                        "id": "1fb70d474997d504db954eb9c12c8a7705824b6d28ab6dd5d4f99938b892cd7e",
                        "attributes": {
                            "id": "1fb70d474997d504db954eb9c12c8a7705824b6d28ab6dd5d4f99938b892cd7e",
                            "rendered": "#!/bin/bash\n\nset -x\nexec 1\u003e /var/tmp/mylog 2\u003e\u00261\n\n# Update hostname\nhostname splunk-indexer-`hostname`\necho `hostname` \u003e /etc/hostname\nsed -i 's/localhost$/localhost '`hostname`'/' /etc/hosts\n\nINSTANCE_IP=\"$(curl http://169.254.169.254/latest/meta-data/local-ipv4)\"\n\n# Create local config files\nmkdir -p /opt/splunk/etc/system/local\n\ncat \u003c\u003cEOF | sudo -u splunk tee /opt/splunk/etc/system/local/deploymentclient.conf\n\nEOF\n\ncat \u003c\u003cEOF | sudo -u splunk tee /opt/splunk/etc/system/local/web.conf\n[settings]\nhttpport        = 8000\nmgmtHostPort    = 127.0.0.1:8089\n\nEOF\n\ncat \u003c\u003cEOF | sudo -u splunk tee /opt/splunk/etc/system/local/server.conf\n[replication_port://9887]\n\n[clustering]\nmode = slave\nmaster_uri = https://cluster-master.service.consul:8089\npass4SymmKey = BitchBetterHaveMyMoney\n\nEOF\nsed -i 's/LOCAL_IP/'${INSTANCE_IP}'/' /opt/splunk/etc/system/local/server.conf\n\ncat \u003c\u003cEOF | sudo -u splunk tee /opt/splunk/etc/system/local/serverclass.conf\n\nEOF\n\n# Start service and Enable autostart\n# sudo -u splunk /opt/splunk/bin/splunk enable boot-start -user splunk --accept-license\n\n\n\n/opt/splunk/bin/entrypoint.sh start-service\n",
                            "template": "#!/bin/bash\n\nset -x\nexec 1\u003e /var/tmp/mylog 2\u003e\u00261\n\n# Update hostname\nhostname splunk-${role}-`hostname`\necho `hostname` \u003e /etc/hostname\nsed -i 's/localhost$/localhost '`hostname`'/' /etc/hosts\n\nINSTANCE_IP=\"$(curl http://169.254.169.254/latest/meta-data/local-ipv4)\"\n\n# Create local config files\nmkdir -p /opt/splunk/etc/system/local\n\ncat \u003c\u003cEOF | sudo -u splunk tee /opt/splunk/etc/system/local/deploymentclient.conf\n${deploymentclient_conf_content}\nEOF\n\ncat \u003c\u003cEOF | sudo -u splunk tee /opt/splunk/etc/system/local/web.conf\n${web_conf_content}\nEOF\n\ncat \u003c\u003cEOF | sudo -u splunk tee /opt/splunk/etc/system/local/server.conf\n${server_conf_content}\nEOF\nsed -i 's/LOCAL_IP/'$${INSTANCE_IP}'/' /opt/splunk/etc/system/local/server.conf\n\ncat \u003c\u003cEOF | sudo -u splunk tee /opt/splunk/etc/system/local/serverclass.conf\n${serverclass_conf_content}\nEOF\n\n# Start service and Enable autostart\n# sudo -u splunk /opt/splunk/bin/splunk enable boot-start -user splunk --accept-license\n\n${cmds_content}\n\n/opt/splunk/bin/entrypoint.sh start-service\n",
                            "vars.%": "6",
                            "vars.cmds_content": "",
                            "vars.deploymentclient_conf_content": "",
                            "vars.role": "indexer",
                            "vars.server_conf_content": "[replication_port://9887]\n\n[clustering]\nmode = slave\nmaster_uri = https://cluster-master.service.consul:8089\npass4SymmKey = BitchBetterHaveMyMoney\n",
                            "vars.serverclass_conf_content": "",
                            "vars.web_conf_content": "[settings]\nhttpport        = 8000\nmgmtHostPort    = 127.0.0.1:8089\n"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "template_file.user_data_master": {
                    "type": "template_file",
                    "depends_on": [
                        "template_file.deploymentclient_conf",
                        "template_file.server_conf_master",
                        "template_file.web_conf"
                    ],
                    "primary": {
                        "id": "26e1cc27a6d04c062f40d3db32064ae2166b46332ae3dbb2e935317342addc1b",
                        "attributes": {
                            "id": "26e1cc27a6d04c062f40d3db32064ae2166b46332ae3dbb2e935317342addc1b",
                            "rendered": "#!/bin/bash\n\nset -x\nexec 1\u003e /var/tmp/mylog 2\u003e\u00261\n\n# Update hostname\nhostname splunk-master-`hostname`\necho `hostname` \u003e /etc/hostname\nsed -i 's/localhost$/localhost '`hostname`'/' /etc/hosts\n\nINSTANCE_IP=\"$(curl http://169.254.169.254/latest/meta-data/local-ipv4)\"\n\n# Create local config files\nmkdir -p /opt/splunk/etc/system/local\n\ncat \u003c\u003cEOF | sudo -u splunk tee /opt/splunk/etc/system/local/deploymentclient.conf\n[deployment-client]\nserverRepositoryLocationPolicy = rejectAlways\nrepositoryLocation = \\$SPLUNK_HOME/etc/master-apps\n[target-broker:deploymentServer]\ntargetUri = deployment-server.service.consul:8089\n\n\nEOF\n\ncat \u003c\u003cEOF | sudo -u splunk tee /opt/splunk/etc/system/local/web.conf\n[settings]\nhttpport        = 8000\nmgmtHostPort    = 127.0.0.1:8089\n\nEOF\n\ncat \u003c\u003cEOF | sudo -u splunk tee /opt/splunk/etc/system/local/server.conf\n[clustering]\nmode = master\nreplication_factor = 2\nsearch_factor = 2\npass4SymmKey = BitchBetterHaveMyMoney\n\n[shclustering]\nid = 776D2949-B2DA-405E-96B3-B6688C87AB7D\npass4SymmKey = BitchBetterHaveMyMoney\nshcluster_label = shcluster\n\nEOF\nsed -i 's/LOCAL_IP/'${INSTANCE_IP}'/' /opt/splunk/etc/system/local/server.conf\n\ncat \u003c\u003cEOF | sudo -u splunk tee /opt/splunk/etc/system/local/serverclass.conf\n\nEOF\n\n# Start service and Enable autostart\n# sudo -u splunk /opt/splunk/bin/splunk enable boot-start -user splunk --accept-license\n\nexport CONFIG_RESTORE_PARENT=\"/tmp\"\nexport CONF__alert_actions__default__hostname=\"splunk.ims.io\"\nexport CONF__collections__service_discovery__disabled=\"false\"\nexport CONF__etc/apps/splunk_httpinput__inputs__http://default__disabled=\"0\"\nexport CONF__etc/apps/splunk_httpinput__inputs__http://default__token=\"EF211A51-D6AC-4045-8CD6-F730939AC518\"\nexport CONF__etc/apps/splunk_httpinput__inputs__http__disabled=\"0\"\nexport CONF__etc/apps/splunk_httpinput__inputs__http__enableSSL=\"0\"\nexport CONF__etc/apps/splunk_httpinput__inputs__http__port=\"8088\"\nexport CONF__etc/apps/splunk_httpinput__inputs__http__useDeploymentServer=\"0\"\nexport CONF__etc/deployment-apps/splunk_httpinput__inputs__http://default__disabled=\"false\"\nexport CONF__etc/deployment-apps/splunk_httpinput__inputs__http://default__token=\"EF211A51-D6AC-4045-8CD6-F730939AC518\"\nexport CONF__etc/deployment-apps/splunk_httpinput__inputs__http__allowSslCompression=\"true\"\nexport CONF__etc/deployment-apps/splunk_httpinput__inputs__http__allowSslRenegotiation=\"true\"\nexport CONF__etc/deployment-apps/splunk_httpinput__inputs__http__dedicatedIoThreads=\"2\"\nexport CONF__etc/deployment-apps/splunk_httpinput__inputs__http__disabled=\"false\"\nexport CONF__etc/deployment-apps/splunk_httpinput__inputs__http__enableSSL=\"false\"\nexport CONF__etc/deployment-apps/splunk_httpinput__inputs__http__maxSockets=\"0\"\nexport CONF__etc/deployment-apps/splunk_httpinput__inputs__http__maxThreads=\"0\"\nexport CONF__etc/deployment-apps/splunk_httpinput__inputs__http__port=\"8088\"\nexport CONF__etc/deployment-apps/splunk_httpinput__inputs__http__sslVersions=\"*,-ssl2\"\nexport CONF__etc/master-apps/cluster-deployment__indexes___audit__repFactor=\"auto\"\nexport CONF__etc/master-apps/cluster-deployment__indexes___internal__repFactor=\"auto\"\nexport CONF__etc/master-apps/cluster-deployment__indexes___thefishbucket__repFactor=\"auto\"\nexport CONF__etc/master-apps/cluster-deployment__indexes__history__repFactor=\"auto\"\nexport CONF__etc/master-apps/cluster-deployment__indexes__main__repFactor=\"auto\"\nexport CONF__etc/master-apps/cluster-deployment__indexes__splunklogger__repFactor=\"auto\"\nexport CONF__etc/master-apps/cluster-deployment__indexes__summary__repFactor=\"auto\"\nexport CONF__inputs__default__host=\"master.service.consul\"\nexport CONF__inputs__http__useDeploymentServer=\"true\"\nexport CONF__meta__collections/service_discovery__access=\"read : [ service_discovery_role ], write : [ service_discovery_role ]\"\nexport CONF__outputs__indexAndForward__index=\"false\"\nexport CONF__outputs__indexer_discovery:search_head_peers__master_uri=\"https://\u003c%MASTER_HOSTNAME%\u003e:8089\"\nexport CONF__outputs__indexer_discovery:search_head_peers__pass4SymmKey=\"changeme\"\nexport CONF__outputs__tcpout:splunk_search_head_peers_group__autoLB=\"true\"\nexport CONF__outputs__tcpout:splunk_search_head_peers_group__indexerDiscovery=\"search_head_peers\"\nexport CONF__outputs__tcpout__defaultGroup=\"splunk_search_head_peers_group\"\nexport CONF__outputs__tcpout__forwardedindex.filter.disable =\"true\"\nexport CONF__outputs__tcpout__indexAndForward=\"false\"\nexport CONF__restmap__broker:broker__requireAuthentication=\"true\"\nexport CONF__server__clustering__cluster_label=\"cluster\"\nexport CONF__server__clustering__mode=\"master\"\nexport CONF__server__clustering__pass4SymmKey=\"changeme\"\nexport CONF__server__clustering__replication_factor=\"3\"\nexport CONF__server__clustering__search_factor=\"2\"\nexport CONF__server__general__serverName=\"master\"\nexport CONF__server__indexer_discovery__pass4SymmKey=\"changeme\"\nexport CONF__server__shclustering__id=\"776D2949-B2DA-405E-96B3-B6688C87AB7D\"\nexport CONF__server__shclustering__pass4SymmKey=\"changeme\"\nexport CONF__server__shclustering__shcluster_label=\"shcluster\"\nexport CONF__serverclass__global__issueReload=\"true\"\nexport CONF__serverclass__global__restartIfNeeded=\"true\"\nexport CONF__serverclass__global__whitelist.0=\"*\"\nexport CONF__web__settings__login_content=\"Cluster Master\"\nexport SPLUNK_ADD_1=\"role service_discovery_role -auth admin:changeme\"\nexport SPLUNK_ADD_2=\"user service_discovery_user -password service_discovery_password -role service_discovery_role -auth admin:changeme\"\nexport SPLUNK_BEFORE_START_CMD_1=\"version $SPLUNK_START_ARGS\"\nexport SPLUNK_BEFORE_START_CMD_2=\"cmd python /opt/splunk/bin/splunk_setup.py --restore-config\"\nexport SPLUNK_BEFORE_START_CMD_3=\"cmd python /opt/splunk/bin/splunk_setup.py --configure\"\nexport SPLUNK_CMD_1=\"cmd python /opt/splunk/bin/splunk_setup.py --wait-splunk 'https://search-head-1.service.consul:8089' '(shc_member|shc_captain)'\"\nexport SPLUNK_CMD_2=\"cmd python /opt/splunk/bin/splunk_setup.py --wait-splunk 'https://search-head-2.service.consul:8089' '(shc_member|shc_captain)'\"\nexport SPLUNK_CMD_4=\"add search-server search-head-1.service.consul:8089 -remoteUsername admin -remotePassword changed -auth admin:changeme\"\nexport SPLUNK_CMD_5=\"add search-server search-head-2.service.consul:8089 -remoteUsername admin -remotePassword changed -auth admin:changeme\"\nexport SPLUNK_CMD_7=\"status\"\nexport SPLUNK_HEALTHCHECK_SPLUNKD=\"https://127.0.0.1:8089\"\nexport SPLUNK_HEALTHCHECK_SPLUNKWEB=\"http://127.0.0.1:8000\"\nexport SPLUNK_START_ARGS=\"--accept-license --answer-yes --no-prompt\"\n\n/opt/splunk/bin/entrypoint.sh start-service\n",
                            "template": "#!/bin/bash\n\nset -x\nexec 1\u003e /var/tmp/mylog 2\u003e\u00261\n\n# Update hostname\nhostname splunk-${role}-`hostname`\necho `hostname` \u003e /etc/hostname\nsed -i 's/localhost$/localhost '`hostname`'/' /etc/hosts\n\nINSTANCE_IP=\"$(curl http://169.254.169.254/latest/meta-data/local-ipv4)\"\n\n# Create local config files\nmkdir -p /opt/splunk/etc/system/local\n\ncat \u003c\u003cEOF | sudo -u splunk tee /opt/splunk/etc/system/local/deploymentclient.conf\n${deploymentclient_conf_content}\nEOF\n\ncat \u003c\u003cEOF | sudo -u splunk tee /opt/splunk/etc/system/local/web.conf\n${web_conf_content}\nEOF\n\ncat \u003c\u003cEOF | sudo -u splunk tee /opt/splunk/etc/system/local/server.conf\n${server_conf_content}\nEOF\nsed -i 's/LOCAL_IP/'$${INSTANCE_IP}'/' /opt/splunk/etc/system/local/server.conf\n\ncat \u003c\u003cEOF | sudo -u splunk tee /opt/splunk/etc/system/local/serverclass.conf\n${serverclass_conf_content}\nEOF\n\n# Start service and Enable autostart\n# sudo -u splunk /opt/splunk/bin/splunk enable boot-start -user splunk --accept-license\n\n${cmds_content}\n\n/opt/splunk/bin/entrypoint.sh start-service\n",
                            "vars.%": "6",
                            "vars.cmds_content": "export CONFIG_RESTORE_PARENT=\"/tmp\"\nexport CONF__alert_actions__default__hostname=\"splunk.ims.io\"\nexport CONF__collections__service_discovery__disabled=\"false\"\nexport CONF__etc/apps/splunk_httpinput__inputs__http://default__disabled=\"0\"\nexport CONF__etc/apps/splunk_httpinput__inputs__http://default__token=\"EF211A51-D6AC-4045-8CD6-F730939AC518\"\nexport CONF__etc/apps/splunk_httpinput__inputs__http__disabled=\"0\"\nexport CONF__etc/apps/splunk_httpinput__inputs__http__enableSSL=\"0\"\nexport CONF__etc/apps/splunk_httpinput__inputs__http__port=\"8088\"\nexport CONF__etc/apps/splunk_httpinput__inputs__http__useDeploymentServer=\"0\"\nexport CONF__etc/deployment-apps/splunk_httpinput__inputs__http://default__disabled=\"false\"\nexport CONF__etc/deployment-apps/splunk_httpinput__inputs__http://default__token=\"EF211A51-D6AC-4045-8CD6-F730939AC518\"\nexport CONF__etc/deployment-apps/splunk_httpinput__inputs__http__allowSslCompression=\"true\"\nexport CONF__etc/deployment-apps/splunk_httpinput__inputs__http__allowSslRenegotiation=\"true\"\nexport CONF__etc/deployment-apps/splunk_httpinput__inputs__http__dedicatedIoThreads=\"2\"\nexport CONF__etc/deployment-apps/splunk_httpinput__inputs__http__disabled=\"false\"\nexport CONF__etc/deployment-apps/splunk_httpinput__inputs__http__enableSSL=\"false\"\nexport CONF__etc/deployment-apps/splunk_httpinput__inputs__http__maxSockets=\"0\"\nexport CONF__etc/deployment-apps/splunk_httpinput__inputs__http__maxThreads=\"0\"\nexport CONF__etc/deployment-apps/splunk_httpinput__inputs__http__port=\"8088\"\nexport CONF__etc/deployment-apps/splunk_httpinput__inputs__http__sslVersions=\"*,-ssl2\"\nexport CONF__etc/master-apps/cluster-deployment__indexes___audit__repFactor=\"auto\"\nexport CONF__etc/master-apps/cluster-deployment__indexes___internal__repFactor=\"auto\"\nexport CONF__etc/master-apps/cluster-deployment__indexes___thefishbucket__repFactor=\"auto\"\nexport CONF__etc/master-apps/cluster-deployment__indexes__history__repFactor=\"auto\"\nexport CONF__etc/master-apps/cluster-deployment__indexes__main__repFactor=\"auto\"\nexport CONF__etc/master-apps/cluster-deployment__indexes__splunklogger__repFactor=\"auto\"\nexport CONF__etc/master-apps/cluster-deployment__indexes__summary__repFactor=\"auto\"\nexport CONF__inputs__default__host=\"master.service.consul\"\nexport CONF__inputs__http__useDeploymentServer=\"true\"\nexport CONF__meta__collections/service_discovery__access=\"read : [ service_discovery_role ], write : [ service_discovery_role ]\"\nexport CONF__outputs__indexAndForward__index=\"false\"\nexport CONF__outputs__indexer_discovery:search_head_peers__master_uri=\"https://\u003c%MASTER_HOSTNAME%\u003e:8089\"\nexport CONF__outputs__indexer_discovery:search_head_peers__pass4SymmKey=\"changeme\"\nexport CONF__outputs__tcpout:splunk_search_head_peers_group__autoLB=\"true\"\nexport CONF__outputs__tcpout:splunk_search_head_peers_group__indexerDiscovery=\"search_head_peers\"\nexport CONF__outputs__tcpout__defaultGroup=\"splunk_search_head_peers_group\"\nexport CONF__outputs__tcpout__forwardedindex.filter.disable =\"true\"\nexport CONF__outputs__tcpout__indexAndForward=\"false\"\nexport CONF__restmap__broker:broker__requireAuthentication=\"true\"\nexport CONF__server__clustering__cluster_label=\"cluster\"\nexport CONF__server__clustering__mode=\"master\"\nexport CONF__server__clustering__pass4SymmKey=\"changeme\"\nexport CONF__server__clustering__replication_factor=\"3\"\nexport CONF__server__clustering__search_factor=\"2\"\nexport CONF__server__general__serverName=\"master\"\nexport CONF__server__indexer_discovery__pass4SymmKey=\"changeme\"\nexport CONF__server__shclustering__id=\"776D2949-B2DA-405E-96B3-B6688C87AB7D\"\nexport CONF__server__shclustering__pass4SymmKey=\"changeme\"\nexport CONF__server__shclustering__shcluster_label=\"shcluster\"\nexport CONF__serverclass__global__issueReload=\"true\"\nexport CONF__serverclass__global__restartIfNeeded=\"true\"\nexport CONF__serverclass__global__whitelist.0=\"*\"\nexport CONF__web__settings__login_content=\"Cluster Master\"\nexport SPLUNK_ADD_1=\"role service_discovery_role -auth admin:changeme\"\nexport SPLUNK_ADD_2=\"user service_discovery_user -password service_discovery_password -role service_discovery_role -auth admin:changeme\"\nexport SPLUNK_BEFORE_START_CMD_1=\"version $SPLUNK_START_ARGS\"\nexport SPLUNK_BEFORE_START_CMD_2=\"cmd python /opt/splunk/bin/splunk_setup.py --restore-config\"\nexport SPLUNK_BEFORE_START_CMD_3=\"cmd python /opt/splunk/bin/splunk_setup.py --configure\"\nexport SPLUNK_CMD_1=\"cmd python /opt/splunk/bin/splunk_setup.py --wait-splunk 'https://search-head-1.service.consul:8089' '(shc_member|shc_captain)'\"\nexport SPLUNK_CMD_2=\"cmd python /opt/splunk/bin/splunk_setup.py --wait-splunk 'https://search-head-2.service.consul:8089' '(shc_member|shc_captain)'\"\nexport SPLUNK_CMD_4=\"add search-server search-head-1.service.consul:8089 -remoteUsername admin -remotePassword changed -auth admin:changeme\"\nexport SPLUNK_CMD_5=\"add search-server search-head-2.service.consul:8089 -remoteUsername admin -remotePassword changed -auth admin:changeme\"\nexport SPLUNK_CMD_7=\"status\"\nexport SPLUNK_HEALTHCHECK_SPLUNKD=\"https://127.0.0.1:8089\"\nexport SPLUNK_HEALTHCHECK_SPLUNKWEB=\"http://127.0.0.1:8000\"\nexport SPLUNK_START_ARGS=\"--accept-license --answer-yes --no-prompt\"",
                            "vars.deploymentclient_conf_content": "[deployment-client]\nserverRepositoryLocationPolicy = rejectAlways\nrepositoryLocation = \\$SPLUNK_HOME/etc/master-apps\n[target-broker:deploymentServer]\ntargetUri = deployment-server.service.consul:8089\n\n",
                            "vars.role": "master",
                            "vars.server_conf_content": "[clustering]\nmode = master\nreplication_factor = 2\nsearch_factor = 2\npass4SymmKey = BitchBetterHaveMyMoney\n\n[shclustering]\nid = 776D2949-B2DA-405E-96B3-B6688C87AB7D\npass4SymmKey = BitchBetterHaveMyMoney\nshcluster_label = shcluster\n",
                            "vars.serverclass_conf_content": "",
                            "vars.web_conf_content": "[settings]\nhttpport        = 8000\nmgmtHostPort    = 127.0.0.1:8089\n"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "template_file.user_data_searchhead": {
                    "type": "template_file",
                    "depends_on": [
                        "template_file.deploymentclient_conf",
                        "template_file.server_conf_searchhead",
                        "template_file.web_conf"
                    ],
                    "primary": {
                        "id": "1d9a7cff6295ac9acca9eb2d7a90e0ecd62b075017f6ef7bd2204d73fae12eef",
                        "attributes": {
                            "id": "1d9a7cff6295ac9acca9eb2d7a90e0ecd62b075017f6ef7bd2204d73fae12eef",
                            "rendered": "#!/bin/bash\n\nset -x\nexec 1\u003e /var/tmp/mylog 2\u003e\u00261\n\n# Update hostname\nhostname splunk-searchhead-`hostname`\necho `hostname` \u003e /etc/hostname\nsed -i 's/localhost$/localhost '`hostname`'/' /etc/hosts\n\nINSTANCE_IP=\"$(curl http://169.254.169.254/latest/meta-data/local-ipv4)\"\n\n# Create local config files\nmkdir -p /opt/splunk/etc/system/local\n\ncat \u003c\u003cEOF | sudo -u splunk tee /opt/splunk/etc/system/local/deploymentclient.conf\n[target-broker:deploymentServer]\ntargetUri = deployment-server.service.consul:8089\n\nEOF\n\ncat \u003c\u003cEOF | sudo -u splunk tee /opt/splunk/etc/system/local/web.conf\n[settings]\nhttpport        = 8000\nmgmtHostPort    = 127.0.0.1:8089\n\nEOF\n\ncat \u003c\u003cEOF | sudo -u splunk tee /opt/splunk/etc/system/local/server.conf\n[general]\nallowRemoteLogin = always\n\n[clustering]\nmode = searchhead\nmaster_uri = https://cluster-master.service.consul:8089\npass4SymmKey = BitchBetterHaveMyMoney\n\n[replication_port://9887]\n\n[shclustering]\nid = 776D2949-B2DA-405E-96B3-B6688C87AB7D\nconf_deploy_fetch_url = https://deployment-server.service.consul:8089\ndisabled = false\nelection_timeout_ms = 10000\nmgmt_uri = https://LOCAL_IP:8089\npass4SymmKey = BitchBetterHaveMyMoney\nreplication_factor = 2\nshcluster_label = shcluster\n\nEOF\nsed -i 's/LOCAL_IP/'${INSTANCE_IP}'/' /opt/splunk/etc/system/local/server.conf\n\ncat \u003c\u003cEOF | sudo -u splunk tee /opt/splunk/etc/system/local/serverclass.conf\n\nEOF\n\n# Start service and Enable autostart\n# sudo -u splunk /opt/splunk/bin/splunk enable boot-start -user splunk --accept-license\n\nexport SPLUNK_BEFORE_START_CMD_1=\"version $SPLUNK_START_ARGS\"\nexport SPLUNK_BEFORE_START_CMD_2=\"cmd python /opt/splunk/bin/splunk_setup.py --wait-splunk 'https://cluster-master:8089' cluster_master kv_store\"\nexport SPLUNK_BEFORE_START_CMD_3=\"cmd python /opt/splunk/bin/splunk_setup.py --configure\"\nexport SPLUNK_BEFORE_START_CMD_4=\"edit user admin -password changed -role admin -auth admin:changeme\"\nexport SPLUNK_BEFORE_START_CMD_5=\"cmd python -c 'open(\"/opt/splunk/etc/.ui_login\", \"a\").close()'\"\nexport SPLUNK_CMD_1=\"cmd python /opt/splunk/bin/splunk_setup.py --shc-autobootstrap 3 https://$HOSTNAME:8089 admin changed 'https://cluster-master:8089/servicesNS/nobody/system/storage/collections/data/service_discovery' service_discovery_user service_discovery_password\"\nexport SPLUNK_CMD_2=\"status\"\n\n\n/opt/splunk/bin/entrypoint.sh start-service\n",
                            "template": "#!/bin/bash\n\nset -x\nexec 1\u003e /var/tmp/mylog 2\u003e\u00261\n\n# Update hostname\nhostname splunk-${role}-`hostname`\necho `hostname` \u003e /etc/hostname\nsed -i 's/localhost$/localhost '`hostname`'/' /etc/hosts\n\nINSTANCE_IP=\"$(curl http://169.254.169.254/latest/meta-data/local-ipv4)\"\n\n# Create local config files\nmkdir -p /opt/splunk/etc/system/local\n\ncat \u003c\u003cEOF | sudo -u splunk tee /opt/splunk/etc/system/local/deploymentclient.conf\n${deploymentclient_conf_content}\nEOF\n\ncat \u003c\u003cEOF | sudo -u splunk tee /opt/splunk/etc/system/local/web.conf\n${web_conf_content}\nEOF\n\ncat \u003c\u003cEOF | sudo -u splunk tee /opt/splunk/etc/system/local/server.conf\n${server_conf_content}\nEOF\nsed -i 's/LOCAL_IP/'$${INSTANCE_IP}'/' /opt/splunk/etc/system/local/server.conf\n\ncat \u003c\u003cEOF | sudo -u splunk tee /opt/splunk/etc/system/local/serverclass.conf\n${serverclass_conf_content}\nEOF\n\n# Start service and Enable autostart\n# sudo -u splunk /opt/splunk/bin/splunk enable boot-start -user splunk --accept-license\n\n${cmds_content}\n\n/opt/splunk/bin/entrypoint.sh start-service\n",
                            "vars.%": "6",
                            "vars.cmds_content": "export SPLUNK_BEFORE_START_CMD_1=\"version $SPLUNK_START_ARGS\"\nexport SPLUNK_BEFORE_START_CMD_2=\"cmd python /opt/splunk/bin/splunk_setup.py --wait-splunk 'https://cluster-master:8089' cluster_master kv_store\"\nexport SPLUNK_BEFORE_START_CMD_3=\"cmd python /opt/splunk/bin/splunk_setup.py --configure\"\nexport SPLUNK_BEFORE_START_CMD_4=\"edit user admin -password changed -role admin -auth admin:changeme\"\nexport SPLUNK_BEFORE_START_CMD_5=\"cmd python -c 'open(\"/opt/splunk/etc/.ui_login\", \"a\").close()'\"\nexport SPLUNK_CMD_1=\"cmd python /opt/splunk/bin/splunk_setup.py --shc-autobootstrap 3 https://$HOSTNAME:8089 admin changed 'https://cluster-master:8089/servicesNS/nobody/system/storage/collections/data/service_discovery' service_discovery_user service_discovery_password\"\nexport SPLUNK_CMD_2=\"status\"\n",
                            "vars.deploymentclient_conf_content": "[target-broker:deploymentServer]\ntargetUri = deployment-server.service.consul:8089\n",
                            "vars.role": "searchhead",
                            "vars.server_conf_content": "[general]\nallowRemoteLogin = always\n\n[clustering]\nmode = searchhead\nmaster_uri = https://cluster-master.service.consul:8089\npass4SymmKey = BitchBetterHaveMyMoney\n\n[replication_port://9887]\n\n[shclustering]\nid = 776D2949-B2DA-405E-96B3-B6688C87AB7D\nconf_deploy_fetch_url = https://deployment-server.service.consul:8089\ndisabled = false\nelection_timeout_ms = 10000\nmgmt_uri = https://LOCAL_IP:8089\npass4SymmKey = BitchBetterHaveMyMoney\nreplication_factor = 2\nshcluster_label = shcluster\n",
                            "vars.serverclass_conf_content": "",
                            "vars.web_conf_content": "[settings]\nhttpport        = 8000\nmgmtHostPort    = 127.0.0.1:8089\n"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "template_file.web_conf": {
                    "type": "template_file",
                    "depends_on": [],
                    "primary": {
                        "id": "205715e642af9deb7ab0b5d3a220fa2747bf5e668b918064994abf57066eabd5",
                        "attributes": {
                            "id": "205715e642af9deb7ab0b5d3a220fa2747bf5e668b918064994abf57066eabd5",
                            "rendered": "[settings]\nhttpport        = 8000\nmgmtHostPort    = 127.0.0.1:8089\n",
                            "template": "[settings]\nhttpport        = ${httpport}\nmgmtHostPort    = 127.0.0.1:${mgmtHostPort}\n",
                            "vars.%": "2",
                            "vars.httpport": "8000",
                            "vars.mgmtHostPort": "8089"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                }
            },
            "depends_on": []
        }
    ]
}
